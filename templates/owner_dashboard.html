{% extends "base.html" %}
{% block title %}Owner Dashboard{% endblock %}
{% block content %}
<div class="space-y-6">
  <!-- Header -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
    <h2 class="text-2xl md:text-3xl font-bold text-tps-gray-dark">Owner Dashboard</h2>
    <div class="flex flex-wrap gap-2 w-full md:w-auto">
      <form method="post" action="{{ url_for('set_primary_currency') }}" class="flex items-center gap-1 md:gap-2">
        <select name="primary_currency" class="px-2 md:px-3 py-2 border border-tps-gray-border rounded-md text-xs md:text-sm focus:outline-none focus:ring-2 focus:ring-tps-blue-dark">
          <option value="USD" {% if stats.primary_currency == 'USD' %}selected{% endif %}>USD</option>
          <option value="CAD" {% if stats.primary_currency == 'CAD' %}selected{% endif %}>CAD</option>
        </select>
        <button class="btn-secondary text-xs md:text-sm px-2 md:px-3 py-2" type="submit">Set</button>
      </form>
    </div>
  </div>

  <!-- Stats Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-3 md:gap-4">
    <div class="stat-card">
      <div class="text-tps-gray-medium text-xs md:text-sm font-medium">Total Trips</div>
      <div class="text-2xl md:text-3xl font-bold text-tps-blue-dark mt-2">{{ stats.total_trips }}</div>
    </div>
    <div class="stat-card">
      <div class="text-tps-gray-medium text-xs md:text-sm font-medium">Active Trips</div>
      <div class="text-2xl md:text-3xl font-bold text-orange-500 mt-2">{{ stats.active_trips }}</div>
    </div>
    <div class="stat-card">
      <div class="text-tps-gray-medium text-xs md:text-sm font-medium">Completed</div>
      <div class="text-2xl md:text-3xl font-bold text-tps-green-text mt-2">{{ stats.completed_trips }}</div>
    </div>
    <div class="stat-card">
      <div class="text-tps-gray-medium text-xs md:text-sm font-medium">Revenue</div>
      <div class="text-xl md:text-2xl font-bold text-tps-green-text mt-2">{{ stats.total_revenue_primary | round(2) }}</div>
      <div class="text-xs text-tps-gray-medium">{{ stats.primary_currency }}</div>
    </div>
    <div class="stat-card">
      <div class="text-tps-gray-medium text-xs md:text-sm font-medium">Expenses</div>
      <div class="text-xl md:text-2xl font-bold text-tps-red mt-2">{{ stats.total_expenses_primary | round(2) }}</div>
      <div class="text-xs text-tps-gray-medium">{{ stats.primary_currency }}</div>
    </div>
    <div class="stat-card">
      <div class="text-tps-gray-medium text-xs md:text-sm font-medium">Net Profit</div>
      <div class="text-xl md:text-2xl font-bold {{ 'text-tps-green-text' if stats.net_primary >= 0 else 'text-tps-red' }} mt-2">
        {{ stats.net_primary | round(2) }}
      </div>
      <div class="text-xs text-tps-gray-medium">{{ stats.primary_currency }}</div>
    </div>
  </div>

  <!-- Actions -->
  <div class="card">
    <h3 class="text-lg font-bold mb-4">Quick Actions</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-2 md:gap-3">
      <a class="btn-primary text-center text-sm md:text-base" href="{{ url_for('new_trip') }}">âž• Create Trip</a>
      <a class="btn-primary text-center text-sm md:text-base" href="{{ url_for('units') }}">ðŸšš Manage Units</a>
      <a class="btn-primary text-center text-sm md:text-base" href="{{ url_for('drivers') }}">ðŸ‘¥ Drivers</a>
      <a class="btn-primary text-center text-sm md:text-base" href="{{ url_for('all_trips') }}">ðŸ“‹ All Trips</a>
    </div>
  </div>

  <!-- Recent Trips -->
  <div class="card">
    <h3 class="text-lg font-bold mb-4">Recent Trips</h3>
    <div class="table-container">
      <table class="w-full text-xs md:text-sm">
        <thead class="bg-tps-gray-light">
          <tr class="border-b border-tps-gray-table-border">
            <th class="px-3 md:px-4 py-3 text-left font-semibold text-tps-gray-medium">Date</th>
            <th class="px-3 md:px-4 py-3 text-left font-semibold text-tps-gray-medium hidden sm:table-cell">Trip #</th>
            <th class="px-3 md:px-4 py-3 text-left font-semibold text-tps-gray-medium hidden md:table-cell">Driver</th>
            <th class="px-3 md:px-4 py-3 text-left font-semibold text-tps-gray-medium">Route</th>
            <th class="px-3 md:px-4 py-3 text-left font-semibold text-tps-gray-medium hidden lg:table-cell">Unit</th>
            <th class="px-3 md:px-4 py-3 text-left font-semibold text-tps-gray-medium">Status</th>
            <th class="px-3 md:px-4 py-3 text-left font-semibold text-tps-gray-medium">Profit</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-tps-gray-table-border">
          {% for t in recent_trips %}
            <tr class="hover:bg-tps-gray-light transition duration-150 table-row">
              <td class="px-3 md:px-4 py-3 whitespace-nowrap text-tps-gray-dark">{{ t.pickup_date }}</td>
              <td class="px-3 md:px-4 py-3 whitespace-nowrap hidden sm:table-cell font-medium text-tps-gray-dark">{{ t.trip_number }}</td>
              <td class="px-3 md:px-4 py-3 whitespace-nowrap hidden md:table-cell text-tps-gray-dark">{{ t.driver_name or '-' }}</td>
              <td class="px-3 md:px-4 py-3 text-tps-gray-dark">{{ t.route }}</td>
              <td class="px-3 md:px-4 py-3 whitespace-nowrap hidden lg:table-cell text-tps-gray-dark">{{ t.unit_number or '-' }}</td>
              <td class="px-3 md:px-4 py-3 whitespace-nowrap">
                <span class="px-2 py-1 text-xs font-semibold rounded-full {{ 'bg-tps-green-bg text-tps-green-border' if t.status == 'active' else 'bg-tps-blue-status-bg text-tps-blue-status-text' }}">
                  {{ t.status|capitalize }}
                </span>
              </td>
              <td class="px-3 md:px-4 py-3 whitespace-nowrap font-bold {{ 'text-tps-green-text' if t.profit >= 0 else 'text-tps-red' }}">
                {{ "%.2f"|format(t.profit) }}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}